---
title: "weekly blog 4/22 ~ 4/28"
description: "React 19 / Node.js 22"
date: "2024/04/29"
published: true
---

## Intro

ä»Šé€±ã¯React19 Betaã®ãƒ–ãƒ­ã‚°ã¨ã€Node.js v22ã®ãƒªãƒªãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã—ãŸã€‚

## [React 19 Beta](https://react.dev/blog/2024/04/25/react-19)

React 19ãŒå…¬é–‹ã•ã‚Œã¾ã—ãŸã€‚

```shell
$ npm install react@beta react-dom@beta
```

ã¨ã™ã‚‹ã“ã¨ã§ä½¿ç”¨å¯èƒ½ã«ãªã‚‹ãã†ã§ã™ã€‚

ç°¡å˜ã«ä»Šå›ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã«ã¤ã„ã¦ã¿ã¦ã„ãã¾ã™ğŸ‘€

### [Whatâ€™s new in React 19](https://react.dev/blog/2024/04/25/react-19#whats-new-in-react-19)

æœ€åˆã«Actionsã«ã¤ã„ã¦ã§ã™ã€‚ã“ã‚Œã¯Server Actionsã®èª¬æ˜ã§ã¯ãªãã€useTrantionã®ã‚ˆã†ãªhooksã‚’ä½¿ã†ã“ã¨ãŒã§ãã‚‹ã¨ã„ã†ç´¹ä»‹ã§ã™ã€‚

```tsx
function UpdateName({}) {
  const [name, setName] = useState("");
  const [error, setError] = useState(null);
  const [isPending, setIsPending] = useState(false); // è‡ªåˆ†ã§stateã‚’ä½œã‚Šã€ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®çŠ¶æ…‹ç®¡ç†ã‚’è¡Œã†

  const handleSubmit = async () => {
    setIsPending(true);
    const error = await updateName(name);
    setIsPending(false);
    if (error) {
      setError(error);
      return;
    } 
    redirect("/path");
  };

  return (
    <div>
      <input value={name} onChange={(event) => setName(event.target.value)} />
      <button onClick={handleSubmit} disabled={isPending}>
        Update
      </button>
      {error && <p>{error}</p>}
    </div>
  );
}

function UpdateName({}) {
  const [name, setName] = useState("");
  const [error, setError] = useState(null);
  const [isPending, startTransition] = useTransition(); // apiã‚’ä½¿ã„ã€ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®çŠ¶æ…‹ç®¡ç†ãŒã§ãã‚‹ã‚ˆã†ã«

  const handleSubmit = async () => {
    startTransition(async () => {
      const error = await updateName(name);
      if (error) {
        setError(error);
        return;
      } 
      redirect("/path");
    })
  };

  return (
    <div>
      <input value={name} onChange={(event) => setName(event.target.value)} />
      <button onClick={handleSubmit} disabled={isPending}>
        Update
      </button>
      {error && <p>{error}</p>}
    </div>
  );
}
```

### new Action features in React 19

Next.jsã§ã™ã§ã«ä½¿ã‚ã‚Œã¦ã„ã‚‹ã‚‚ã®ã¯ç´¹ä»‹ä¸è¦ã‹ã¨æ€ã†ã®ã§ã€ãƒªãƒ³ã‚¯ã ã‘ã«ã—ã¦ãŠãã¾ã™ã€‚è‡ªåˆ†ã¯æ–°ã—ã„APIã®ã¿ç´¹ä»‹ã—ã¾ã™ã€‚

#### [useActionState](https://react.dev/reference/react/useActionState)

```ts
const [error, submitAction, isPending] = useActionState(async (previousState, newName) => {
  const error = await updateName(newName);
  if (error) {
    // You can return any result of the action.
    // Here, we return only the error.
    return error;
  }
  
  // handle success
});
```

ã“ã¡ã‚‰ã¯ä»¥å‰ã¾ã§å­˜åœ¨ã—ã¦ã„ãŸuseFormStateã«æ–°ã—ãpendingãŒè¿”ã£ã¦ãã‚‹ã‚ˆã†ã«å¤‰æ›´ã•ã‚ŒãŸhooksã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚‹useFormStateã¯éæ¨å¥¨ã«ãªã‚Šã¾ã—ãŸã€‚

#### [New hook: useOptimistic](https://react.dev/blog/2024/04/25/react-19#new-hook-optimistic-updates)

```tsx
function ChangeName({currentName, onUpdateName}) {
  const [optimisticName, setOptimisticName] = useOptimistic(currentName); 

  const submitAction = async formData => {
    const newName = formData.get("name");
    setOptimisticName(newName);
    const updatedName = await updateName(newName);
    onUpdateName(updatedName);
  };

  return (
    <form action={submitAction}>
      <p>Your name is: {optimisticName}</p>
      <p>
        <label>Change Name:</label>
        <input
          type="text"
          name="name"
          disabled={currentName !== optimisticName}
        />
      </p>
    </form>
  );
}
```

æ¬¡ã«`useOptimistic`ã«ã¤ã„ã¦ã§ã™ã€‚ä»¥å‰ã‹ã‚‰ã‚ã£ãŸã®ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€è‡ªåˆ†ãŒçŸ¥ã‚‰ãªã‹ã£ãŸã®ã§ãƒ¡ãƒ¢ã¨ã—ã¦æ®‹ã—ã¦ãŠãã¾ã™ã€‚

optimistic updateã¨ã¯æ—¥æœ¬èªã ã¨ã€Œæ¥½è¦³çš„æ›´æ–°ã€ã¿ãŸã„ãªé¢¨ã«ç›´è¨³ã™ã‚‹ã¨ãªã‚Šã¾ã™ã€‚è¨€è‘‰ã¨ã—ã¦ã¯ã‚ã‹ã‚Šã¥ã‚‰ã„ã§ã™ãŒã€ã‚ˆã†ã¯å‡¦ç†ã®çµæœã«é–¢ä¿‚ãªãè¦‹ãŸç›®ã‚’å¤‰åŒ–ã•ã›ãŸã„æ™‚ã«ä½¿ã†ã‚‚ã®ã§ã™ã€‚

#### New API: [use](https://react.dev/blog/2024/04/25/react-19#new-feature-use)

```tsx
// Client Component
import {use} from 'react';

function Comments({commentsPromise}) {
  // `use` will suspend until the promise resolves.
  const comments = use(commentsPromise);
  return comments.map(comment => <p key={comment.id}>{comment}</p>);
}

// Server Component
function Page({commentsPromise}) {
  // When `use` suspends in Comments,
  // this Suspense boundary will be shown.
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <Comments commentsPromise={commentsPromise} />
    </Suspense>
  )
}
```

ç¶šã„ã¦`use` apiã§ã™ã€‚ã“ã‚Œã¯tanstack queryãŒå…¬å¼APIã§æä¾›ã•ã‚ŒãŸã¨ã„ã†ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’è‡ªåˆ†ã¯æŒã£ã¦ã„ã¾ã™ã€‚

ã—ã‹ã—å€‹äººçš„ã«ã¯ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒã¯Server Componentã§æ¸ˆã¾ã›ã‚‰ã‚Œã‚‹ã¨æ€ã£ã¦ãŠã‚Šã€â†‘ ã®å‚è€ƒã‚³ãƒ¼ãƒ‰ã‚‚ã‚ã–ã‚ã–propsã§promiseã‚’å—ã‘å–ã‚‹ã‚ˆã†ã«ã™ã‚‹å¿…è¦ã¯ã‚ã‚‹ã®ã‹ãªã¨ã„ã†æ°—æŒã¡ãŒã‚ã‚Šã¾ã™ã€‚ï¼ˆã“ã‚Œã¯ã‚µãƒ³ãƒ—ãƒ«ãªã®ã§ä¸€ã¤ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã¨ã—ã¦æ›¸ã„ã¦ãã‚Œã¦ã‚‹ã ã‘ã‹ã¨æ€ã„ã¾ã™ãŒ...ï¼‰

Client Componentã§ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒã‚’è¡Œã„ãŸã„æ™‚ï¼ˆSPAãªã‚¢ãƒ—ãƒªã‚’ä½œã‚‹æ™‚ï¼‰ã«ã€è‡ªå‰ã§promiseã¨thorwã—ãŸã‚Šã—ãªãã¦è‰¯ã„ã®ã¯ä¾¿åˆ©ãã†ã ãªã¨æ€ã„ã¾ã—ãŸã€‚

#### ãã®ä»–ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ

- [React DOM: `<form>` Actions](https://react.dev/blog/2024/04/25/react-19#form-actions)
  - react-domãŒformã‚’æ‹¡å¼µã—ã¦ã„ã‚‹ã‚ˆã¨ã„ã†è©±ã§ã™
  - actionã‚’ä½¿ã†ã“ã¨ã§ãƒ•ã‚©ãƒ¼ãƒ å‡¦ç†ãŒè‡ªå‹•åŒ–ã•ã‚Œã¾ã™ã€‚
- [React Server Components](https://react.dev/blog/2024/04/25/react-19#react-server-components)
  - ã‚‚ã†è¨€è‘‰ã¯ã„ã‚‹ã¾ã„ 
- [Server Actions](https://react.dev/blog/2024/04/25/react-19#server-actions) 
  - useActionStateã¨æ‹¡å¼µã—ãŸformã¨ä¸€ç·’ã«ä½¿ã†ã“ã¨ãŒå¤šãã† 
- [ref as a prop](https://react.dev/blog/2024/04/25/react-19#ref-as-a-prop)
  - refãŒpropsã§å—ã‘å–ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ 
- [Diffs for hydration errors](https://react.dev/blog/2024/04/25/react-19#ref-as-a-prop)
  - hidrationã®ã‚¨ãƒ©ãƒ¼ãŒã‚ã‹ã‚Šã‚„ã™ããªã£ãŸãã†
- [`<Context>` as a provider](https://react.dev/blog/2024/04/25/react-19#context-as-a-provider)
  - Context APIã‚’ä½¿ã†æ™‚ã¯`Context.Provider`ã§å›²ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸãŒã“ã®ProviderãŒã„ã‚‰ãªããªã£ãŸã‚ˆã¨ã„ã†è©±
  - Providerã¯å»ƒæ­¢ã«ãªã‚‹ãã†
- [Cleanup functions for refs](https://react.dev/blog/2024/04/25/react-19#cleanup-functions-for-refs)
  - refã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚
  - ä»Šã¾ã§ã¯ `ref = null` ã¿ãŸã„ãªæ„Ÿã˜ã§åˆæœŸåŒ–ã—ã¦ã„ãŸï¼ˆã‚ˆã†ãªæ°—ãŒã™ã‚‹...ï¼‰
- [useDeferredValue initial value](https://react.dev/blog/2024/04/25/react-19#use-deferred-value-initial-value)
  - `useDeferredValue`ã«åˆæœŸå€¤ãŒå…¥ã‚Œã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚
  - ã“ã‚“ãªhooksã‚ã‚‹ã“ã¨ã‚’è‡ªåˆ†ã¯ä»ŠçŸ¥ã‚Šã¾ã—ãŸã€‚
- [Support for Document Metadata](https://react.dev/blog/2024/04/25/react-19#support-for-metadata-tags)
  - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã«metadataã‚’å…¥ã‚Œã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚
  - è‰¯ã•ãã†ã§ã¯ã‚ã‚‹ã‘ã©ãã“ã‚‰ã‹ã—ã“ã«metadataæ›¸ãã®ã¯ã©ã†ãªã‚“ã§ã—ã‚‡ã†ã‹...ğŸ§
- [Support for stylesheets](https://react.dev/blog/2024/04/25/react-19#support-for-stylesheets)
  - ä»¥ä¸‹åŒæ–‡

## [React 19 Beta Upgrade Guide](https://react.dev/blog/2024/04/25/react-19-upgrade-guide)

ã„ã‚ã‚“ãªAPIãŒå‰Šé™¤ã•ã‚Œã¦ã„ãŸã‚Šã¨ã‹ã€ç´°ã‹ã„å¤‰æ›´ãªã©ãŒè¼‰ã£ã¦ã„ã¾ã™ã€‚

## [Node.js 22 is now available!](https://nodejs.org/en/blog/announcements/v22-release-announce)

Node.js22ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆæƒ…å ±ã§ã™ã€‚è‡ªåˆ†ãŒæ°—ã«ãªã£ãŸã‚‚ã®ã‚’ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¦ã„ãã¾ã™ã€‚

### Maglev

v8ã§Maglevã¨ã„ã†ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã—ãŸã€‚

è‡ªåˆ†ãŒv8å‘¨ã‚Šã®çŸ¥è­˜ãŒæµ…ã„ã®ã§ã€[å¤å·ã•ã‚“ã®è³‡æ–™](https://speakerdeck.com/yosuke_furukawa/node-dot-js-v22-debian-warukoto?slide=17)ãŒã¨ã¦ã‚‚å‚è€ƒã«ãªã‚Šã¾ã—ãŸã€‚æ°—ã«ãªã‚‹æ–¹ã¯ãœã²ã¿ã¦ã¿ã¦ãã ã•ã„ï¼

### Support require()ing synchronous ESM graphs

CJSã‹ã‚‰ESMã®ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿è¾¼ã‚ã‚‹ã‚ˆã†ã«ãªã£ãŸã¨ã„ã†è©±ã§ã™ã€‚
ã“ã¡ã‚‰ã«ã¤ã„ã¦ã¯ä»¥å‰è‡ªåˆ†ãŒè¦ç´„ã¨ã—ã¦[Weekly](https://yossy.dev/posts/weekly-2024-0323)ã«ã¾ã¨ã‚ã¦ã„ã‚‹ã®ã§ãã¡ã‚‰ã‚‚ã”è¦§ãã ã•ã„

## ã¾ã¨ã‚

ç„¡äº‹ã«ã‚¢ãƒ—ãƒ‡ã«ã¤ã„ã¦ã¾ã¨ã‚ã‚‰ã‚Œã¾ã—ãŸã€‚ä»Šå›ã¯Reactã¯ã©ã†ã„ã£ãŸæ©Ÿèƒ½ãªã®ã‹ã‚’ã¿ãŸã ã‘ã§ã™ãŒã€ã¾ãŸã©ã“ã‹ã§ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚“ã§ãƒ–ãƒ­ã‚°ã«ã¾ã¨ã‚ãŸã„ã‚‚ã®ã§ã™ã€‚

## é–¢é€£

- [React 19 Beta](https://react.dev/blog/2024/04/25/react-19)
- [React 19 Beta Upgrade Guide](https://react.dev/blog/2024/04/25/react-19-upgrade-guide)
- [Node.js 22 is now available!](https://nodejs.org/en/blog/announcements/v22-release-announce)
