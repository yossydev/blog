---
title: "typescript-eslintã§ã¯ã©ã®ã‚ˆã†ã«å‹æƒ…å ±ãŒå¿…è¦ãªãƒ«ãƒ¼ãƒ«ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã®ã‹"
description: "ã“ã®è¨˜äº‹ã§ã¯ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ç”Ÿã«ã€Œå‹æƒ…å ±ãŒå¿…è¦ãªESLintãƒ«ãƒ¼ãƒ«ã¨ã¯ä½•ã‹ã¨ã¯ãªã‚“ã§ã™ã‹ï¼Ÿã€ã¨èã‹ã‚ŒãŸéš›ã«å…·ä½“ä¾‹ã‚’æç¤ºã§ããªã‹ã£ãŸã®ã¨ã€è‰²ã€…èª¿ã¹ã‚‹ã¨æœ€åˆã«æƒ³å®šã—ã¦ã„ãŸã‚‚ã®ã¨ã‹ãªã‚Šé•ã£ã¦ã„ãŸã®ã§ã€ãƒ–ãƒ­ã‚°ã«ã¾ã¨ã‚ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚"
date: "2024/09/01"
published: true
---

## Intro

ã“ã®è¨˜äº‹ã§ã¯ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ç”Ÿã«ã€Œå‹æƒ…å ±ãŒå¿…è¦ãªESLintãƒ«ãƒ¼ãƒ«ã¨ã¯ä½•ã‹ã¨ã¯ãªã‚“ã§ã™ã‹ï¼Ÿã€ã¨èã‹ã‚ŒãŸéš›ã«å…·ä½“ä¾‹ã‚’æç¤ºã§ããªã‹ã£ãŸã®ã¨ã€è‰²ã€…èª¿ã¹ã‚‹ã¨æœ€åˆã«æƒ³å®šã—ã¦ã„ãŸã‚‚ã®ã¨ã‹ãªã‚Šé•ã£ã¦ã„ãŸã®ã§ã€ãƒ–ãƒ­ã‚°ã«ã¾ã¨ã‚ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚

## æ›¸ã‹ãªã„ã“ã¨

ã“ã®è¨˜äº‹ã§ã¯ä»¥ä¸‹ã®å†…å®¹ã«ã¤ã„ã¦ã¯è§¦ã‚Œã¾ã›ã‚“ã€‚

- flat configã¨ã¯ä½•ã‹ãƒ»è¨­å®šæ–¹æ³•
- typescript-eslintã¨ã¯ä½•ã‹ãƒ»è¨­å®šæ–¹æ³•
- è‡ªä½œãƒ«ãƒ¼ãƒ«ã®ä½œæˆæ–¹æ³•ã«ã¤ã„ã¦

## TSESTreeã‚’è¦‹ã¦ã¿ã‚‹

æœ¬é¡Œã«å…¥ã‚‹å‰ã«ã€å…ˆã«typescript-eslintãŒã©ã®ã‚ˆã†ãªASTã‚’ç”Ÿæˆã™ã‚‹ã®ã‹è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
(ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã¯[await-thenable](https://typescript-eslint.io/rules/await-thenable/)ã®ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚ä»¥é™ã‚‚ãã®ãƒ«ãƒ¼ãƒ«ãŒã‚ˆãå‡ºã¦ãã¾ã™ã€‚)

```ts
const fooFn = async () => {
  const createValue = async () => 'value';
  await createValue();  
}
```

TypeScriptã®ASTã®è¦ç´„ã¨ã—ã¦ã€TSESTreeãŒã‚ã‚Šã¾ã™ã€‚[ã“ã¡ã‚‰ã®Playground](https://typescript-eslint.io/play#ts=5.5.2&showAST=es&fileType=.ts&esQuery=N4IgZglgNgLgpgJxALhCAvkA&code=MYewdgzgLgBAZiEAxMMC8MCGECeZgwAUAlOgHwwDeAUDDKJLMAE4CmmUrAapgDYCurdFlz4ipNBQDkANz6CpAblpYA7pgCWTNh27zWJRXWoBfIA&eslintrc=N4KABGBEBOCuA2BTAzpAXGUEKQAIBcBPABxQGNoBLY-AWhXkoDt8B6AQwHd3K78ALRE3YAjJOiiJo0APbRI4MAF8QSoA&tsconfig=N4KABGBEDGD2C2AHAlgGwKYCcDyiAuysAdgM6QBcYoEEkJemy0eAcgK6qoDCAFutAGsylBm3TgwAXxCSgA&tokens=false)ã§ã¯ã€å…ˆã»ã©ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã®ASTã®ç”Ÿæˆã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
èª­ã‚“ã§ã„ãŸã ã‘ã‚Œã°ã‚ã‹ã‚‹ã‹ã¨æ€ã„ã¾ã™ãŒã€å…ˆã»ã©ã®ã‚³ãƒ¼ãƒ‰ã®ASTã§ã¯å‹å®šç¾©ã«é–¢ã™ã‚‹è¨˜è¼‰ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã‚Œã¯é–“é•ã£ã¦ã¯ãªãã€æ­£ã—ã„æŒ™å‹•ã«ãªã£ã¦ã„ã¾ã™ã€‚ä¸€æ—¦ç„¡è¦–ã—ã¦ã„ãŸã ã„ã¦å¤§ä¸ˆå¤«ã§ã™ã€‚

ã§ã¯æ¬¡ã«ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚

```diff
const fooFn = async () => {
-  const createValue = async () => 'value';
+  const createValue = async (): Promise<string> => 'value';
  await createValue();  
}
```

é•ã„ã¨ã—ã¦ã¯ã€æ˜ç¤ºçš„ã«createValueã®è¿”ã‚Šå€¤ã®å‹ã‚’è¨˜è¼‰ã—ã¦ã„ã¾ã™ã€‚
ãã—ã¦ä»Šå›ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªNodeãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ã€‚ï¼ˆç”Ÿæˆã•ã‚ŒãŸå…¨ã¦ã®ASTã¯[ã“ã¡ã‚‰](https://typescript-eslint.io/play/#ts=5.5.2&showAST=es&fileType=.ts&esQuery=N4IgZglgNgLgpgJxALhCAvkA&code=MYewdgzgLgBAZiEAxMMC8MCGECeZgwAUAlOgHwwDeAUDDKJLMAE4CmmUrAapgDYCurdFlz4ixAFwwACsxABbAJYRWAHmjNFYAOYU0FAOQA3PoIMBuWlgDumRUzYdup1iUsBfIA&eslintrc=N4KABGBEBOCuA2BTAzpAXGUEKQAIBcBPABxQGNoBLY-AWhXkoDt8B6AQwHd3K78ALRE3YAjJOiiJo0APbRI4MAF8QSoA&tsconfig=N4KABGBEDGD2C2AHAlgGwKYCcDyiAuysAdgM6QBcYoEEkJemy0eAcgK6qoDCAFutAGsylBm3TgwAXxCSgA&tokens=false)ã‹ã‚‰ç¢ºèªã§ãã¾ã™ã€‚
ï¼‰
```json
{
  "typeAnnotation": {
    "type": "TSTypeReference",
    "typeName": {
      "type": "Identifier",
      "decorators": [],
      "name": "Promise",
      "optional": false,
      "range": [60, 67],
      "loc": {
        "start": {
          "line": 2,
          "column": 32
        },
        "end": {
          "line": 2,
          "column": 39
        }
      }
    },
    "typeArguments": {
      "type": "TSTypeParameterInstantiation",
      "range": [67, 75],
      "params": [
        {
          "type": "TSStringKeyword",
          "range": [68, 74],
          "loc": {
            "start": {
              "line": 2,
              "column": 40
            },
            "end": {
              "line": 2,
              "column": 46
            }
          }
        }
      ],
      "loc": {
        "start": {
          "line": 2,
          "column": 39
        },
        "end": {
          "line": 2,
          "column": 47
        }
      }
    },
    "range": [60, 75],
    "loc": {
      "start": {
        "line": 2,
        "column": 32
      },
      "end": {
        "line": 2,
        "column": 47
      }
    }
  }
}
```

ã“ã“ã¾ã§ã§ä½•ãŒè¨€ã„ãŸã‹ã£ãŸã®ã‹ã„ã†ã¨ã€**TSESTreeã§ã¯å‹æ¨è«–ã‚’ã—ãŸã‚‚ã®ã¯ASTã«ç”Ÿæˆã•ã‚Œã¾ã›ã‚“ã€‚**
ä»¥é™ã®è©±ã§ã‚‚ã“ã®å†…å®¹ãŒãƒã‚¤ãƒ³ãƒˆã«ãªã£ã¦ã„ã¾ã™ã€‚

## å‹æƒ…å ±ãŒå¿…è¦ã¨ã¯ã©ã†ã„ã†ã“ã¨ã‹

ãªã‚“ã¨ãªãtypescript-eslintãŒç”Ÿæˆã™ã‚‹ASTã«ã¤ã„ã¦ç†è§£ã—ãŸã¨ã“ã‚ã§ã€ä»Šå›ã®æœ¬é¡Œã§ã™ã€‚
**å‹æƒ…å ±ãŒå¿…è¦**ã¨ã¯ã¤ã¾ã‚Šã©ã†ã„ã†ã“ã¨ãªã®ã§ã—ã‚‡ã†ã‹ã€‚

ä»Šå›ã¯[await-thenable](https://typescript-eslint.io/rules/await-thenable/)ã‚’ä¾‹ã«ã€ä»¥é™ã®è©±ã‚’é€²ã‚ã¦ã„ãã¾ã™ã€‚
å¿µã®ç‚ºç°¡å˜ã«ã“ã®ãƒ«ãƒ¼ãƒ«ã®èª¬æ˜ã‚’ã—ã¦ãŠãã¨ã€ã“ã®ãƒ«ãƒ¼ãƒ«ã¯ã€thenãƒ¡ã‚½ãƒƒãƒ‰ãŒä½¿ãˆã‚‹ã‹ã©ã†ã‹ã§ã€awaitã®ä½¿ç”¨ã‚’åˆ¶å¾¡ã™ã‚‹ãƒ«ãƒ¼ãƒ«ã§ã™ã€‚ãã—ã¦ã“ã®ãƒ«ãƒ¼ãƒ«ã¯å‹æƒ…å ±ãŒå¿…è¦ã¨æ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚

ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

**âŒ Invalid**
```ts
// case1
await 'value';

// case2
const createValue = () => 'value';
await createValue();
```

**âœ… Valid**

```ts
// case1
await Promise.resolve('value');

// case2
const createValue = async () => 'value';
await createValue();
```

å…¬å¼ã«ã‚ã‚‹ã‚‚ã®ãã®ã¾ã¾ã§ã™ãŒã€Promiseã‚’è¿”ã™ã‹è¿”ã•ãªã„ã‹ã§é•ã„ãŒã‚ã‚‹ã®ãŒã‚ã‹ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚
ã“ã®æ™‚ç‚¹ã§èª­ã‚“ã§ã‚‹æ–¹ã®ä¸­ã§ã¯ã€ã€Œasyncã¨ã‹Promise.resoluveã‚’ä½¿ã£ã¦ã„ã‚‹ã‹ã©ã†ã‹ã§åˆ¤æ–­ã™ã‚Œã°ã„ã„ã®ã§ã¯ï¼ŸğŸ¤”ã€ã¨æ€ã‚ã‚ŒãŸæ–¹ã‚‚ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚å®Ÿéš›ã«æœ€åˆã¯è‡ªåˆ†ã‚‚ãã†æ€ã„ã¾ã—ãŸã€‚

ã“ã“ã§ã‚‚ã†ä¸€åº¦ASTã‚’è¦‹ã¦ã¾ã—ã‚‡ã†ã€‚ä»Šåº¦ã¯å¿…è¦ãªéƒ¨åˆ†ã ã‘æŠœç²‹ã™ã‚‹ã®ã¨ã€ã‚ã‹ã‚Šã‚„ã™ã„ã®ã§case2ã®æ–¹ã§è©±ã‚’é€²ã‚ã¾ã™ã€‚

`const createValue = async () => 'value';`ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```json
  "body": [
    {
      "type": "VariableDeclaration",
      "declarations": [
        {
          "type": "VariableDeclarator",
          "definite": false,
          "id": {
            "type": "Identifier",
            "decorators": [],
            "name": "createValue",
            "optional": false,
            ...etc 
          },
          "init": {
            "type": "ArrowFunctionExpression",
            "generator": false,
            "id": null,
            "params": [],
            "body": {
              "type": "Literal",
              "value": "value",
              "raw": "'value'",
              ...etc 
            },
            "async": true, // â†  asyncãŒæ›¸ã‹ã‚Œã¦ã„ã‚‹ã¨ã“ã“ãŒtrueã«ãªã‚‹
            "expression": true,
            ...etc 
          },
          ...etc 
        }
      ],
      "declare": false,
      "kind": "const",
      ...etc 
    }
  ],
  "comments": [],
  "sourceType": "script",
  "tokens": [
    ...etc
  ],
  ...etc 
```

`async: true`ã¨ã„ã†ç®‡æ‰€ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯æ§‹æ–‡ã¨ã—ã¦asyncã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã«trueã«ãªã‚Šã¾ã™ã€‚
å½“ç„¶ã§ã™ãŒ`async`ã‚’ä½¿ã£ã¦ã„ãªã‘ã‚Œã°ã“ã¡ã‚‰ã¯falseã¨ãªã‚Šã¾ã™ã€‚

æ¬¡ã«ã€`await createValue();`ã®éƒ¨åˆ†ã®ASTã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```json
  "body": [
    {
      "type": "ExpressionStatement",
      "expression": {
        "type": "AwaitExpression",
        "argument": {
          "type": "CallExpression",
          "callee": {
            "type": "Identifier",
            "decorators": [],
            "name": "createValue",
            "optional": false,
            ...etc
          },
          "arguments": [],
          "optional": false,
          ...etc
        },
        ...etc
      },
      ...etc
    }
  ],
```

awaitã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§`AwaitExpression`ã¨ã„ã†Nodeã«ãªã£ã¦ã„ã¾ã™ã€‚
ã—ã‹ã—ã€ãã‚Œä»¥å¤–ã®æƒ…å ±ã¯ãªãã€`createValue`ãŒPromiseã‚’è¿”ã™ã‹ã©ã†ã‹ã«ã¤ã„ã¦ã®æƒ…å ±ã¯ãªã„ã“ã¨ãŒç¢ºèªã§ãã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

**await-thenableã®ãƒ«ãƒ¼ãƒ«ã¨ã—ã¦ã¯ã€createValueãŒPromiseã‚’è¿”ã•ãªã„ã®ã«awaitã‚’ä½¿ç”¨ã—ã¦ã„ãŸå ´åˆã‚¨ãƒ©ãƒ¼ï¼ˆã‚‚ã—ãã¯è­¦å‘Šï¼‰ã‚’å‡ºã—ãŸã„ã¯ãšã§ã™ãŒã€ASTã‚’ã¿ã‚‹é™ã‚Šã§ã¯ãã‚ŒãŒé›£ã—ã„ã‚ˆã†ã«æ€ãˆã¾ã™ã€‚
ã“ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«ã€å‹æƒ…å ±ã‚’ä½¿ç”¨ã—ã¦å¯¾è±¡ã®lintãƒ«ãƒ¼ãƒ«ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚**

## ã©ã®ã‚ˆã†ã«ã—ã¦å‹ã®æƒ…å ±ã‚’å¾—ã¦ã„ã‚‹ã®ã‹

ã“ã‚Œã¾ã§ã®æƒ…å ±ã§ã€å‹æƒ…å ±ãŒå¾—ã‚‰ã‚Œãªã„ã¨ã€lintãƒ«ãƒ¼ãƒ«ã®ä½œæˆãŒé›£ã—ã„ã“ã¨ãŒç†è§£ã§ããŸã‹ã¨æ€ã„ã¾ã™ã€‚
ã§ã¯æ¬¡ã«ã€typescript-eslintã§ã¯ã©ã®ã‚ˆã†ã«ã—ã¦å‹æƒ…å ±ã‚’æ‰±ã£ã¦ã„ã‚‹ã®ã§ã—ã‚‡ã†ã‹ã€‚

**TSESTreeã‚’è¦‹ã¦ã¿ã‚‹**ã¨ã„ã†è¦‹å‡ºã—ã§ã€é–¢æ•°ã®è¿”ã‚Šå€¤ã®å‹ã‚’æ˜ç¤ºçš„ã«è¨˜è¼‰ã—ãŸå ´åˆã«ã¯ã€ASTã«ãã®å‹å®šç¾©ã‚‚è¿½è¨˜ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚
é€†ã«è¨€ãˆã°ã€å‹æ¨è«–ã§ã¯ASTã«è¨˜è¼‰ã•ã‚Œãªã„ã§ã™ã€‚

ã§ã¯ã©ã†ã‚„ã£ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã®ã§ã—ã‚‡ã†ã‹ã€‚ç­”ãˆã¯**typescript-eslintã§ã¯typescriptã®apiã‚’ä½¿ç”¨ã—ã¦å‹ã®ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚**

await-thenableã®[å®Ÿè£…ã‚³ãƒ¼ãƒ‰](https://github.com/typescript-eslint/typescript-eslint/blob/main/packages/eslint-plugin/src/rules/await-thenable.ts)ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```ts
import * as tsutils from 'ts-api-utils';

...etc

  create(context) {
    const services = getParserServices(context);
    const checker = services.program.getTypeChecker();

    return {
      AwaitExpression(node): void {
        const type = services.getTypeAtLocation(node.argument);
        if (isTypeAnyType(type) || isTypeUnknownType(type)) {
          return;
        }

        const originalNode = services.esTreeNodeToTSNodeMap.get(node);

        if (!tsutils.isThenableType(checker, originalNode.expression, type)) {
          context.report({
            messageId: 'await',
            node,
            suggest: [
              {
                messageId: 'removeAwait',
                fix(fixer): TSESLint.RuleFix {
                  const awaitKeyword = nullThrows(
                    context.sourceCode.getFirstToken(node, isAwaitKeyword),
                    NullThrowsReasons.MissingToken('await', 'await expression'),
                  );

                  return fixer.remove(awaitKeyword);
                },
              },
            ],
          });
        }
      },
    };
  },
```

`tsutils.isThenableType`ã§ã¯ã€`å—ã‘å–ã£ãŸtypeã«thenãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå­˜åœ¨&&å—ã‘å–ã£ãŸNodeã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ãŒä¸€ã¤ã‚ã‚‹&&callbackã‚’è¿”ã™`ã¨ã„ã†å ´åˆã«trueï¼ˆPromiseã‚’è¿”ã™å¼ã«ãªã£ã¦ã„ã‚‹ã“ã¨ï¼‰ã«ãªã‚Šã¾ã™ã€‚
getTypeCheckerã‚„ã€ts-api-utilsã‚’ã•ã‚‰ã«ã¿ã¦ã„ãã¨ã€TypeScriptã®APIã‚’å‘¼ã³å‡ºã—ã¦ã„ã¾ã™ã€‚

typescript-eslintã§ã¯ã“ã®ã‚ˆã†ã«ã—ã¦ã€å‹æƒ…å ±ã‚’ä½¿ã£ãŸlintãƒ«ãƒ¼ãƒ«ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚

## ã¾ã¨ã‚

ä»Šå›ãƒ–ãƒ­ã‚°ã‚’æ›¸ãã«ã‚ãŸã£ã¦typescript-eslintã®ã‚³ãƒ¼ãƒ‰ã‚„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚“ã§ã„ãŸã®ã§ã™ãŒã€å‹æƒ…å ±ã‚’ä½¿ã£ãŸLintãƒ«ãƒ¼ãƒ«ã‚’ä½œã‚‹ãŸã‚ã®å·¥å¤«ãŒå£é–“è¦‹ãˆã€ãã—ã¦ã“ã‚Œã ã‘ã®ã‚³ãƒ¼ãƒ‰é‡ã«å¯¾ã—ä½¿ç”¨è€…ã¯ã»ã¨ã‚“ã©å†…éƒ¨æ§‹é€ ã‚’æ„è­˜ã›ãšã¨ã‚‚ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã®ãŒé–‹ç™ºä½“é¨“ç´ æ™´ã‚‰ã—ã„ãªã¨æ„Ÿã˜ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚ç­†è€…ã¨ã—ã¦ã‚‚å­¦ã³ãŒå¤šã‹ã£ãŸã§ã™ã€‚

## å‚è€ƒãƒ»é–¢é€£

- [await-thenable](https://typescript-eslint.io/rules/await-thenable/)
- [await-thenable.ts](https://github.com/typescript-eslint/typescript-eslint/blob/main/packages/eslint-plugin/src/rules/await-thenable.ts)
