---
title: "Chrome 130ã§ã®CSSãƒã‚¹ãƒ†ã‚£ãƒ³ã‚°æ”¹å–„: CSSNestedDeclarationsã®è©³ç´°"
description: "web.devãŒå…ˆæ—¥ã€CSS nesting improves with CSSNestedDeclarationsã¨ã„ã†ãƒ–ãƒ­ã‚°ã‚’å…¬é–‹ã—ã¾ã—ãŸã€‚ã“ã®ãƒ–ãƒ­ã‚°ã§ã¯ã€CSSãƒã‚¹ãƒ†ã‚£ãƒ³ã‚°ã®ä»•æ§˜ã«CSSNestedDeclarationsãŒè¿½åŠ ã•ã‚ŒãŸã“ã¨ã«ã¤ã„ã¦æ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚å°å…¥èƒŒæ™¯ã‚„CSSOMã®å‹•ããªã©ãŒå°‘ã—é¢ç™½ã‹ã£ãŸã®ã§ãƒ–ãƒ­ã‚°ã«ã¾ã¨ã‚ã¾ã—ãŸã€‚"
date: "2024/10/13"
updatedAt: "2024/10/13"
published: true
---

## Intro

[web.dev](https://web.dev/?hl=en)ãŒå…ˆæ—¥ã€[CSS nesting improves with CSSNestedDeclarations](https://web.dev/blog/css-nesting-cssnesteddeclarations?hl=en)ã¨ã„ã†ãƒ–ãƒ­ã‚°ã‚’å…¬é–‹ã—ã¾ã—ãŸã€‚

ã“ã®ãƒ–ãƒ­ã‚°ã§ã¯ã€CSSãƒã‚¹ãƒ†ã‚£ãƒ³ã‚°ã®ä»•æ§˜ã«`CSSNestedDeclarations`ãŒè¿½åŠ ã•ã‚ŒãŸã“ã¨ã«ã¤ã„ã¦æ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚æœãŸã—ã¦æ¥­å‹™ã§ã“ã®ãƒ–ãƒ­ã‚°ã§æ›¸ã‹ã‚Œã¦ã‚‹ã‚ˆã†ãªã‚ˆã†ãªå‹•ãã«å‡ºãã‚ã™ã“ã¨ã¯ãªã‹ã£ãŸæ°—ã‚‚ã—ã¾ã™ãŒã€CSSOMã®å‹•ããªã©å°‘ã—é¢ç™½ã‹ã£ãŸã®ã§æ›¸ãã“ã¨ã«ã—ã¾ã—ãŸã€‚

## è©±ã•ãªã„ã“ã¨

ã“ã®è¨˜äº‹ã§ã¯ä»¥ä¸‹ã®å†…å®¹ã«ã¤ã„ã¦ã¯æ›¸ãã¾ã›ã‚“ã€‚

- CSS nestingã¨ã¯
- CSSã®parseå‡¦ç†ã«ã¤ã„ã¦

## CSSãƒã‚¹ãƒ†ã‚£ãƒ³ã‚°ã§ã®ä»¥å‰ã¾ã§ã®ä»•æ§˜

ã¾ãšCSSãƒã‚¹ãƒ†ã‚£ãƒ³ã‚°ã®ä»¥å‰ã¾ã§ã®ä»•æ§˜ã«ã¤ã„ã¦ã§ã™ã€‚
ä»¥ä¸‹ã®ã‚ˆã†ãªCSSã‚’æ›¸ã„ãŸå ´åˆã€çš†ã•ã‚“ã¯ã©ã®ã‚ˆã†ãªUIã«ãªã‚‹ã¨æ€ã„ã¾ã™ã‹ï¼Ÿï¼Ÿ

```css
.foo {
	width: fit-content;

	@media screen and (min-width: 900px) {
		background-color: red;
	}

	background-color: green;
}
```

é–¢é€£: [github.com/yossydev/css-nesting-improves-with-cssnesteddeclarations](https://github.com/yossydev/css-nesting-improves-with-cssnesteddeclarations)

ã“ã®å ´åˆã€é©ç”¨ã•ã‚Œã‚‹background-colorã¯redğŸ›‘ã«ãªã‚Šã¾ã™ã€‚

<img src="https://github.com/user-attachments/assets/d2c31c61-c0fc-4584-a26f-ae813863db64"/>

ï¼ˆå·¦: Chrome129 / å³: Chrome130ï¼‰

ã—ã‹ã—ã€CSSã®ä»•æ§˜ã¨ã—ã¦ã¯å¾Œã‚ã«æ›¸ã‹ã‚ŒãŸã‚³ãƒ¼ãƒ‰ãŒé©ç”¨ã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚ã“ã‚ŒãŒChrome 129ã¾ã§ã®CSSãƒã‚¹ãƒ†ã‚£ãƒ³ã‚°ã®ä»•æ§˜ã§ã—ãŸã€‚

## ãªãœã“ã®ã‚ˆã†ãªä»•æ§˜ã ã£ãŸã®ã‹

ãªãœã“ã®ã‚ˆã†ãªä»•æ§˜ã«ãªã£ã¦ã„ãŸã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ

[Intent to Ship: The Nested Declarations Rule](https://groups.google.com/a/chromium.org/g/blink-dev/c/Do1Xyu-PzyU/m/Xn1IjDtPAQAJ)ã¨ã„ã†ã‚„ã‚Šå–ã‚Šã®ä¸­ã«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

> This was at the time done intentionally for a mix of CSSOM and historical reasons, and all implementations of CSS Nesting currently agree on this behavior. However, it turns out this shifting behavior isnâ€™t what authors expect (WebKit blog post), and the CSSWG now consider the decision a mistake. In October 2023, the CSSWG resolved to not do the shifting behavior anymore 

å°‘ã—é•·ã„ã®ã§ã€è¦ç´„ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

- CSSOMã®æ­´å²çš„èƒŒæ™¯ã‹ã‚‰ã€Shifting(å…¥ã‚Œæ›¿ã‚ã‚Š)ã•ã‚Œã‚‹ã‚ˆã†ãªæŒ™å‹•ã§å®Ÿè£…ã‚’è¡Œã£ãŸ
- ã—ã‹ã—ä½œè€…ï¼ˆauthorsã®ç›´è¨³ã€å¤šåˆ†ç§ãŸã¡ã®ã‚ˆã†ãªé–‹ç™ºè€…ã®ã“ã¨ã‚’æŒ‡ã—ã¦ã„ã‚‹ã¨æ€ã†...ï¼Ÿï¼Ÿï¼‰ãŒæƒ³å®šã—ã¦ã„ãŸå‹•ãã¨ç•°ãªã£ã¦ã„ãŸ
- ãã—ã¦CSSWGãŒã“ã®Shiftingã™ã‚‹ã‚ˆã†ãªä»•æ§˜ã‚’mistakeã ã¨ã—ãŸ

å®Ÿè£…ã—ãŸæ™‚ç‚¹ã§ã¯ãã®æ–¹é‡ã§é€²ã‚“ã§ã„ãŸã‘ã©ã€ãã‚Œã‚’ä½¿ç”¨ã™ã‚‹é–‹ç™ºè€…ã«ã¨ã£ã¦ã¯æ€ã£ã¦ã„ãŸæŒ™å‹•ã¨é•ã£ãŸã®ã§ç›´ã™ã“ã¨ã«ã—ãŸã€‚ã¨ã„ã†ã“ã¨ã‚‰ã—ã„ã§ã™ã€‚


## ã©ã®ã‚ˆã†ã«Shitingã•ã‚Œã‚‹ã®ã‹

ã§ã¯æ¬¡ã«ã€å®Ÿéš›ã«ã©ã®ã‚ˆã†ã«Shitingã•ã‚Œã‚‹ã®ã‚’ã¿ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
å…ˆã»ã©ã®CSSã«å¯¾ã—ã¦ç”Ÿæˆã•ã‚ŒãŸCSSOMã‚’ä¾‹ã«ã—ã¾ã™ã€‚

```
â†³ CSSStyleRule
  .type = STYLE_RULE
  .selectorText = ".foo"
  .resolvedSelectorText = ".foo"
  .specificity = (0,1,0)
  .style (CSSStyleDeclaration, 2) =
    - width: fit-content
    - background-color: green
  .cssRules (CSSRuleList, 1) =
    â†³ CSSMediaRule
    .type = MEDIA_RULE
    .cssRules (CSSRuleList, 1) =
      â†³ CSSStyleRule
        .type = STYLE_RULE
        .selectorText = "&"
        .resolvedSelectorText = ":is(.foo)"
        .specificity = (0,1,0)
        .style (CSSStyleDeclaration, 1) =
          - background-color: red
```

`background-color: green`ã¯`CSSStyleRule.style`ã«å«ã¾ã‚Œã¦ã„ã‚‹ã‚‚ã®ã®ã€`@media screen`ã®å¾Œã«å®šç¾©ã•ã‚ŒãŸã‹ã©ã†ã‹ã¯ã‚ã‹ã‚‰ãªã„ã§ã™ã€‚ãã®ãŸã‚ã€ãƒ‘ãƒ¼ã‚¹ã•ã‚ŒãŸCSSã‚’ã¿ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ï¼ˆå‡ºåŠ›ã•ã‚ŒãŸçµæœã‹ã‚‰è¦‹ã‚„ã™ããªã‚‹ã‚ˆã†ã«å°‘ã—æ•´å½¢ã—ã¦ã„ã¾ã™ï¼‰

```
.foo {
  width: fit-content; 
  background-color: green;

  @media screen and (min-width: 900px) {
    background-color: red;
  }
}
```

ã“ã®çµæœã€`background-color: green`ãŒ`@media screen`ã‚ˆã‚Šã‚‚ä¸Šã«æ¥ã¦ã—ã¾ã„ã¾ã—ãŸã€‚ã“ã‚Œã§ã¯CSSã®å„ªå…ˆé †ä½çš„ã«ã€`min-width: 900px`ãŒæ­£ã®æ™‚ã¯redãŒé©ç”¨ã•ã‚Œã¾ã™ã€‚

ï¼ˆãã‚‚ãã‚‚å¸¸ã«`background-color: green`ã«ã—ãŸã„ãªã‚‰`background-color: red`ã„ã‚‰ãªã„ã®ã§ã¯ï¼Ÿã¿ãŸã„ãªã”æ„è¦‹ã¯ã”ã‚‚ã£ã¨ã‚‚ã§ã™ï¼‰

## CSSNestedDeclarationsã®è¿½åŠ 

CSS Working Groupã¯Shiftingã‚’è§£æ¶ˆã™ã‚‹ãŸã‚ã«ã€æ–°ã—ã[nested declarations rule](https://drafts.csswg.org/css-nesting/#nested-declarations-rule)ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚

åŒã˜CSSã®å†…å®¹ã«å¯¾ã—ã¦ã€Chrome130ã‹ã‚‰ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ã«ãªã‚Šã¾ã™ã€‚

```
â†³ CSSStyleRule
  .type = STYLE_RULE
  .selectorText = ".foo"
  .resolvedSelectorText = ".foo"
  .specificity = (0,1,0)
  .style (CSSStyleDeclaration, 1) =
    - width: fit-content
  .cssRules (CSSRuleList, 2) =
    â†³ CSSMediaRule
      .type = MEDIA_RULE
      .cssRules (CSSRuleList, 1) =
        â†³ CSSNestedDeclarations
          .style (CSSStyleDeclaration, 1) =
            - background-color: red
    â†³ CSSNestedDeclarations
      .style (CSSStyleDeclaration, 1) =
        - background-color: green
```

ä»Šåº¦ã¯`CSSNestedDeclarations`ã¨ã„ã†ã‚‚ã®ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã®ãŒã‚ã‹ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚
ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ‘ãƒ¼ã‚µãƒ¼ã¯ä»¥å‰ã®å®£è¨€ã®ä½ç½®ã‚’ç¶­æŒã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

### `@nest`

ä»Šå›`CSSNestedDeclarations`ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸãŒã€æœ€åˆã®ææ¡ˆã§ã¯`@nest`ã¨ã„ã†ã‚‚ã®ãŒææ¡ˆã•ã‚Œã¦ã„ãŸã‚ˆã†ã§ã—ãŸã€‚ï¼ˆ[CSS Nesting: @nest](https://github.com/WebKit/standards-positions/issues/337)ï¼‰

ãã—ã¦ã“ã®ææ¡ˆã«é–¢ã—ã¦ã€Webkitå´ãŒæ‹’å¦ã—ã¦ã„ã¾ã™ã€‚

> WebKit strongly opposes introducing an @nest rule for this purpose. We don't think expanding the syntax space of CSS for the convenience of CSSOM representation is an acceptable cost to authors, and prefer a solution that represents interleaved style declarations in the CSSOM in a way that does not have an externality on CSS syntax.
> ref: https://github.com/WebKit/standards-positions/issues/337#issuecomment-2078329470

CSSOMã®ãŸã‚ã«åå‰ç©ºé–“ã‚’æ‹¡å¼µã™ã‚‹ã®ã¯å¥½ã¾ã—ããªãã€CSSã®æ§‹æ–‡ã«å½±éŸ¿ã‚’ä¸ãˆãªã„ã‚ˆã†ã«ã€CSSOMã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æ‹¡å¼µã™ã‚‹ã“ã¨ãŒç†æƒ³ã¨ã®ã“ã¨ã§ã™ã€‚
ã‚ã¾ã‚Šã“ã“ã¯æœ¬é¡Œã¨é€¸ã‚Œã‚‹ã®ã§ã€ã“ã®ãã‚‰ã„ã«ã—ã¦ãŠãã¾ã™ã€‚

## ã¾ã¨ã‚

ä»Šå›ã¯Chrome130ã§è¿½åŠ ã•ã‚Œã‚‹`CSSNestedDeclarations`ã«ã¤ã„ã¦ã€å°å…¥èƒŒæ™¯ã¨ä¸€ç·’ã«è¦‹ã¦ã„ãã¾ã—ãŸã€‚
CSSã®ãƒ‘ãƒ¼ã‚¹ã«ã¤ã„ã¦ã€æ­£ç›´ä»Šã¾ã§è€ƒãˆã¦é–‹ç™ºã‚’ã—ã¦ã“ãªã‹ã£ãŸã®ã§ã€ä»Šå›ã®å†…å®¹ã§èˆˆå‘³ã‚’æŒã¤ãã£ã‹ã‘ã«ãªã‚Šã¾ã—ãŸã€‚ç‰¹ã«ä»Šå›ã¯ã‚ã¾ã‚Šè§¦ã‚Œã‚‰ã‚Œã¦ã„ãªã„ã®ã§ã™ãŒã€[nested declarations rule](https://drafts.csswg.org/css-nesting/#nested-declarations-rule)ã®å…·ä½“çš„ãªå®Ÿè£…å†…å®¹ã¿ãŸã„ãªã¨ã“ã‚ã‚‚ã€æ™‚é–“ãŒã‚ã‚Œã°èª­ã‚“ã§ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

## è¿½è¨˜ãƒ»ç·¨é›†

ã„ãã¤ã‹ä»Šå›ã®å†…å®¹ã§ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã„ãŸã ã„ãŸã®ã§ã€å†…å®¹ã®ä¿®æ­£ã‚’åŠ ãˆã¦ã„ã¾ã™ã€‚

- 10/14: **ãƒã‚°ã¨ã„ã†è¡¨ç¾ãŒé©åˆ‡ã§ã¯ãªã‹ã£ãŸã‚ã€CSSã®ä»•æ§˜ã§ã‚ã‚‹ã¨ã„ã†è¨€è‘‰ã®ä½¿ã„æ–¹ã«ä¿®æ­£ã—ã¾ã—ãŸã€‚**
- 10/14: **CSSã®shitingã®å•é¡Œã«ã¤ã„ã¦è¿½è¨˜ã—ã¾ã—ãŸã€‚**

ã”æŒ‡æ‘˜ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸğŸ™‡â€â™‚ï¸

## å‚è€ƒãƒ»é–¢é€£

- [CSS nesting improves with CSSNestedDeclarations](https://web.dev/blog/css-nesting-cssnesteddeclarations?hl=en)
- [nested declarations rule](https://drafts.csswg.org/css-nesting/#nested-declarations-rule)
- [Intent to Ship: The Nested Declarations Rule](https://groups.google.com/a/chromium.org/g/blink-dev/c/Do1Xyu-PzyU/m/Xn1IjDtPAQAJ) 
- [Intent to Ship: Stable Bare Declarations (@nest)](https://groups.google.com/a/chromium.org/g/blink-dev/c/prg4CN0eEGg)
