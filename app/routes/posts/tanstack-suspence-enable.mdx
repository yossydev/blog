---
title: "Tanstack Queryã®useSuspenceQueryã§ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã—ãŸããªã„æ™‚ã¯ã©ã®ã‚ˆã†ã«ã™ã‚‹ã‹"
description: "hooksè‡ªä½“ã‚’æ¡ä»¶åˆ†å²ã™ã‚‹ã“ã¨ã¯åˆ¶ç´„ä¸Šä¸å¯èƒ½ã§ã€useSuspenceQueryã«ã¯useQueryã«ã¯enbaledã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚‚ã‚ã‚Šã¾ã›ã‚“ã€‚ã§ã¯useSuspenceQueryã§ã¯ã©ã®ã‚ˆã†ã«ã—ã¦å®Ÿè¡Œã®åˆ¶å¾¡ã‚’è¡Œã†ã‹ã€‚ã¨ã„ã†ã“ã¨ã«ã¤ã„ã¦æ›¸ãã¾ã—ãŸã€‚"
date: "2024/07/21"
published: true
---

## Intro

æ¥­å‹™ã§Tanstack Queryã‚’ä½¿ã£ã¦ã„ã‚‹ã‚“ã§ã™ãŒã€ãã“ã§åˆã‚ã¦[useSuspenceQuery](https://tanstack.com/query/latest/docs/framework/react/reference/useSuspenseQuery)ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚
ã“ã®hooksã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒPromiseã‚’è¿”ã™ã‚ˆã†ã«ãªã‚Šã€Reactã®Suspenceã‚’ä½¿ã£ã¦fallbackã‚’è¿”ã™ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ã¨ã¦ã‚‚ä¾¿åˆ©ãªhooksã§ã™ãŒã€**æ¡ä»¶ã«ã‚ˆã£ã¦å®Ÿè¡Œã—ãŸããªã„**ã¨ã„ã†ã‚±ãƒ¼ã‚¹ã§å°‘ã—æ‚©ã‚“ã ãƒã‚¤ãƒ³ãƒˆãŒã‚ã£ãŸã®ã§ã€ä»Šå›ã¯ãã®ã“ã¨ã«ã¤ã„ã¦æ›¸ãã¾ã™ã€‚

## è©±ã•ãªã„ã“ã¨

ä»Šå›ã¯ä»¥ä¸‹ã«ã¤ã„ã¦ã¯è©±ã•ãªã„ã§ã™ã€‚

- enabledä»¥å¤–ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦
- useSuspenceQueryã‚„useQueryã®ä½¿ã„æ–¹
- Suspenceã®ã‚ˆã†ãªReactã®APIã«ã¤ã„ã¦ã®ç´¹ä»‹

ã¾ãŸã€è¨˜äº‹ã®ä¸­ã«æ›¸ã„ãŸå‚è€ƒã‚³ãƒ¼ãƒ‰ã¯ã‚ãã¾ã§ã‚‚å‚è€ƒç¨‹åº¦ã§ãŠé¡˜ã„ã—ã¾ã™ğŸ™‡â€â™‚ï¸

## Tanstack Queryã®Suspenceç³»ã®hooksç´¹ä»‹

æœ€åˆã«ä»Šå›ã¯[useSuspenceQuery](https://tanstack.com/query/latest/docs/framework/react/reference/useSuspenseQuery)ã‚’ä½¿ã£ã¦è¨˜äº‹ã‚’æ›¸ã„ã¦ã„ã¾ã™ãŒã€Suspenceç³»ã®hooksã¯å…¨éƒ¨ã§3ã¤ã‚ã‚Šã¾ã™ã€‚ 

- [useSuspenceQuery](https://tanstack.com/query/latest/docs/framework/react/reference/useSuspenseQuery) 
- [useSuspenseInfiniteQuery](https://tanstack.com/query/latest/docs/framework/react/reference/useSuspenseInfiniteQuery) 
- [useSuspenseQueries](https://tanstack.com/query/latest/docs/framework/react/reference/useSuspenseQueries)

## useQueryã§ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã—ãªã„æ–¹æ³•

[useQuery](https://tanstack.com/query/latest/docs/framework/react/reference/useQuery)ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ä¸€ã¤ã¨ã—ã¦ã€`enabled`ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€hooksã®å®Ÿè¡Œã‚’åˆ¶å¾¡ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

[Playground](https://tanstack.com/query/latest/docs/framework/react/examples/playground)ã§è©¦ã—ã¦ã¿ãŸã¨ã“ã‚ã€å®Ÿéš›ã«queryã¯å®Ÿè¡Œã•ã‚Œãšã€statusã¯`pending`ã®ã¾ã¾ã§ã—ãŸã€‚

```tsx
  const { status, data, isFetching, error, failureCount, refetch } = useQuery({
    queryKey: ['todos', { filter }],
    queryFn: fetchTodos,
    enabled: false, // falseã«ã™ã‚‹ã¨queryã¯å®Ÿè¡Œã•ã‚Œãªã„
  });

  return (
      {status === 'pending' ? (
        <span>Loading... (Attempt: {failureCount + 1})</span>
      ) : status === 'error' ? (
        <span>
          Error: {error.message}
          <br />
          <button onClick={() => refetch()}>Retry</button>
        </span>
      ) : (
        <ul>
          ...other
        </ul>
      )}
  );
}
```

hooksè‡ªä½“ã«æ¡ä»¶åˆ†å²ãŒã§ããªã„ä»¥ä¸Šã€ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ã¨ã¦ã‚‚ä¾¿åˆ©ã ãªã¨ç­†è€…ã¯æ„Ÿã˜ã¾ã—ãŸã€‚

## useSuspenceQueryã§ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã—ãªã„æ–¹æ³•

ã§ã¯æ¬¡ã«useSuspenceQueryã‚’è¦‹ã¦ã„ãã¾ã™ã€‚åŒã˜ã‚ˆã†ã«enabledã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ãŸã„ã§ã™ãŒã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚

> The same as for useQueries, except that each query can't have:
> - suspense
> - throwOnError
> - enabled
> - placeholderData 

ãã†ã§ã™ã€‚`useSuspenceQuery`ã§ã¯enabledã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ä½¿ç”¨ã§ããªã„ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

### useSuspenceQueryã§ã¯ãªãœenabledã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒä½¿ãˆãªã„ã®ã‹

[useSuspenseQuery and enabled v5](https://github.com/TanStack/query/discussions/6206)ã¨ã„ã†ãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã€ã“ã“ã§ä½œè€…ã®æ–¹ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚³ãƒ¡ãƒ³ãƒˆã—ã¦ã„ã¾ã™ã€‚

> enabled is not included because one of the main expectations of suspense is that if you call useSuspenseQuery, data will be T, not T | undefined, because loading states are handled by suspense and errors by error boundaries. That's not the case if we allow to disable a query. Further, you don't need it for dependent queries, because with suspense, queries run in serial anyways. If you need enabled to wait for user input, component composition is the way to go (splitting components up)
> <br/>
> æ—¥æœ¬èªè¨³: suspenseã‚’ä½¿ç”¨ã™ã‚‹ä¸»ãªæœŸå¾…ã®1ã¤ã¯ã€useSuspenseQueryã‚’å‘¼ã³å‡ºã™ã¨ã€ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã¯suspenseã«ã‚ˆã£ã¦å‡¦ç†ã•ã‚Œã€ã‚¨ãƒ©ãƒ¼ã¯ã‚¨ãƒ©ãƒ¼ãƒã‚¦ãƒ³ãƒ€ãƒªãƒ¼ã«ã‚ˆã£ã¦å‡¦ç†ã•ã‚Œã‚‹ãŸã‚ã€ãƒ‡ãƒ¼ã‚¿ãŒT | undefinedã§ã¯ãªãTã«ãªã‚‹ã“ã¨ã§ã™ã€‚ã‚¯ã‚¨ãƒªã‚’ç„¡åŠ¹ã«ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã™ã‚‹å ´åˆã€ã“ã‚Œã¯å½“ã¦ã¯ã¾ã‚Šã¾ã›ã‚“ã€‚ã•ã‚‰ã«ã€ä¾å­˜ã‚¯ã‚¨ãƒªã«ã¯enabledã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚ãªãœãªã‚‰ã€suspenseã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€ã‚¯ã‚¨ãƒªã¯ã‚·ãƒªã‚¢ãƒ«ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‹ã‚‰ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’å¾…ã¤ãŸã‚ã«enabledãŒå¿…è¦ãªå ´åˆã¯ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ§‹æˆï¼ˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®åˆ†å‰²ï¼‰ãŒè§£æ±ºç­–ã§ã™ã€‚

(ä¸€å¿œã‚ã‹ã‚Šã‚„ã™ã„ã‚ˆã†ã«æ—¥æœ¬èªè¨³ã‚‚è¿½è¨˜ã—ã¦ãŠãã¾ã—ãŸã€‚)

**ã¤ã¾ã‚Š`enabled`ãŒä¸è¦ãªç†ç”±ã¯ä»¥ä¸‹ã®äºŒã¤ãŒç†ç”±ã§ã‚ã‚‹ã¨ã‚ã‹ã‚Šã¾ã—ãŸã€‚**

- Suspenceã‚„Error Boundaryã‚’ä½¿ã†ã“ã¨ã§ãƒ‡ãƒ¼ã‚¿ã‚’`T`ã¨ã—ã¦æ‰±ã†ã“ã¨ãŒã§ãã‚‹ã¯ãšãŒã€enbaledã‚’ä½¿ã†ã“ã¨ã§`undefined`ãªå¯èƒ½æ€§ãŒç”Ÿã¾ã‚Œã¦ã—ã¾ã†
- Suspenceã«PromiseãŒè¿”ã‚‹ã¨ãã‚Œä»¥é™ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã¯ã‚¹ãƒˆãƒƒãƒ—ã™ã‚‹ã®ã§ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®åˆ†å‰²ã‚’ã™ã‚Œã°è‰¯ã„

ç­†è€…ã¨ã—ã¦ã¯ã€Suspenceã¨Error Boundaryã¨ã„ã†Reactã®æ©Ÿèƒ½ã«ã†ã¾ãä¹—ã£ã‹ã‚Œã¦ã„ã‚‹æ°—ãŒã™ã‚‹ã®ã§ç†ç”±ã¨ã—ã¦ã¯ç´å¾—ã—ã¾ã—ãŸã€‚

### å®Ÿè¡Œã•ã›ãŸããªã„æ™‚ã«ã¯ã©ã®ã‚ˆã†ã«ã™ã‚‹ã®ã‹

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ç™ºã—ã¦ã„ã‚‹ã¨ã€å®Ÿéš›ã«ç™ºç«ã•ã›ãŸããªã„ã“ã¨ã¯ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚ã‚„ã‚Šæ–¹ã¯äºŒã¤ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒã‚ã‚‹ã‹ãªã¨æ€ã„ã¾ã™ã€‚

#### 1. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’åˆ†å‰²ã™ã‚‹

å…ˆã»ã©ã®ä¾‹ã§ã‚‚ã§ãã¦ããŸã‚ˆã†ã«ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’é©åˆ‡ã«åˆ†å‰²ã™ã‚‹æ–¹æ³•ã§ã™ã€‚ä»¥ä¸‹ã¯å‚è€ƒã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

```tsx
import React, { Suspense } from 'react';
import { useQuery } from '@tanstack/react-query';

function ParentComponent({ shouldFetch }: { shouldFetch: boolean }) {
  return (
    <div>
      {shouldFetch ? (
        <Suspense fallback={<div>Loading...</div>}>
          <ChildComponent1 />
        </Suspense>
      ) : (
        <div>Data fetching is disabled</div>
      )}
      <ChildComponent2 />
    </div>
  );
}

function ChildComponent1() {
  const data = useSuspenseQuery({
    queryKey: ['something', param],
    queryFn: () => fetchSomething(param),
  });

  return <div>{data}</div>;
}

function ChildComponent2() {
  return <div>Child Component 2</div>;
}
```

`shouldFetch`ã®ã¨ã“ã‚ãŒã€ä¾‹ãˆã°ç©ºæ–‡å­—ã ã£ãŸã‚‰ã€œã¿ãŸã„ãªæ¡ä»¶å¼ã«å¤‰ã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚
åŸºæœ¬çš„ã«ã¯ã“ã‚Œã§å•é¡Œãªã„ã‹ã¨æ€ã„ã¾ã™ãŒã€ãã®åˆ†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®é‡ãŒå¢—ãˆã‚‹ã®ã§ã€å…¨ã¦ã“ã‚Œã§å¯¾å¿œã™ã‚‹ã®ã¯å°‘ã—å³ã—ã„ã®ã§ã¯ã¨æ€ã£ã¦ã„ã¾ã™ã€‚

#### 2. queryFnå†…ã§æ¡ä»¶åˆ†å²ã‚’è¡Œã†

[useSuspenseQuery and enabled v5](https://github.com/TanStack/query/discussions/6206)ã§ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹ã‚„ã‚Šæ–¹ã§ã™ã€‚ä»¥ä¸‹ã¯å‚è€ƒã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

```ts
useSuspenseQuery({
  queryKey['something', param],
  queryFn: () => param ? fetchSomething(param) : null,
})
```

queryFnã§æ¡ä»¶åˆ†å²ã—ã€trueã§ã‚ã‚Œã°apiã‚’å©ãã€ãã†ã§ãªã‘ã‚Œã°nullã‚’è¿”ã‚‹ã‚ˆã†ã«ã™ã‚‹å‡¦ç†ã«ã—ã¦ã„ã¾ã™ã€‚
ã“ã¡ã‚‰ã§ã‚ã‚Œã°å‡¦ç†ã‚’hooksã«é–‰ã˜è¾¼ã‚ã‚‰ã‚Œã‚‹ã®ã§ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé‡ãŒå¢—ãˆã‚‹å•é¡Œã¯å›é¿ã§ããã†ã§ç­†è€…ã¨ã—ã¦ã¯å¥½ã¿ã§ã™ã€‚

## ã¾ã¨ã‚

enabledã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€å®Ÿè£…ä¸­ã®æ™‚ã¯ãªãœãªã„ã®ã‹ã¨ã„ã†æ°—æŒã¡ã§ã—ãŸãŒã€ç«‹ã¡æ­¢ã¾ã£ã¦è€ƒãˆã‚‹ã¨ç´å¾—ã§ãã‚‹ç†ç”±ãŒã‚ã‚Šã—ã£ãã‚Šãã¾ã—ãŸã€‚
è‡ªåˆ†ã¯ã‚ã¾ã‚ŠTanstack Queryã‚’ä½¿ã„ã“ãªã›ã¦ã„ã‚‹è‡ªä¿¡ã¯ãªã„ã®ã§ã€ã‚‚ã£ã¨ä½¿ã„è¾¼ã‚“ã§ã„ããŸã„ã§ã™ã€‚

## é–¢é€£

- [useSuspenceQuery](https://tanstack.com/query/latest/docs/framework/react/reference/useSuspenseQuery) 
- [useSuspenseQuery and enabled v5](https://github.com/TanStack/query/discussions/6206) 

